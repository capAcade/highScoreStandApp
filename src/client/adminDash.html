<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

</head>

<body>
    <div class="container-fluid">
        <h1>The ugly admin dashboard</h1>
        <p>This admin dashboard does just do what it suppost to do. nothing fancy it just works!</p>
        <div class="row">
            <div class="col-sm">
                <h2>some cool buttonz</h2>
                <button type="button" sv-click="startGame" class="btn btn-primary btn-lg" id="resetGame">reset
                    game</button>
                <button type="button" sv-click="resetGame" class="btn btn-success btn-lg" id="startGame">start
                    game</button>

                <h2>Add player: </h2>
                <form>
                    <div class="form-group">
                        <label for="email">email</label>
                        <input type="text" sv-module="email" class="form-control" id="email" placeholder="bla@bla.com">
                    </div>
                    <div class="form-group">
                        <label for="nickName">nickname</label>
                        <input type="text" sv-module="nickName" class="form-control" id="nickName"
                            placeholder="coolName">
                    </div>
                    <div class="form-group">
                        <label for="fullName">fullname</label>
                        <input type="text" sv-module="fullName" class="form-control" id="fullName"
                            placeholder="yolo lala">
                    </div>
                    <button type="button" sv-click="submitNewPlayer" class="btn btn-success btn-lg" id="addPlayer">add
                        Player</button>
                </form>

            </div>
            <div class="col-sm">
                <h2>add Stub players</h2>
                <div class="btn-group" role="group" aria-label="Basic example">
                    <button type="button" sv-click="addPokeMaster" id="pokeMaster" class="btn btn-secondary">add
                        pokeMaster</button>
                    <button type="button" sv-click="addMashdamman" id="mashdamman" class="btn btn-secondary">add
                        mashdamman</button>
                    <button type="button" sv-click="addBugganator" id="bugganator" class="btn btn-secondary">add the
                        bugganator</button>
                    <button type="button" sv-click="addSamuraiJack" id="SamuraiJack" class="btn btn-secondary">add
                        Samurai jack</button>
                </div>
                <h2>update score</h2>
                <form>
                    <div class="form-group">
                        <label for="scoreInput">score</label>
                        <input type="number" sv-module="score" class="form-control" id="scoreInput" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="playerSelect">player</label>
                        <select class="form-control" sv-module="selectNickname" id="playerSelect">
                            <option>empty</option>
                        </select>
                    </div>
                    <button type="button" sv-click="updateScore" class="btn btn-success btn-lg" id="updateScore">Update
                        score</button>
                </form>
            </div>
            <div class="col-sm">
                <strong>connection websocket is<span id="statusSocket">unknown</span></strong>

                <div>
                    <h2>active players:</h2>
                    <div>
                        <ul id="activePlayersList">
                            <li>player one</li>
                            <li>player two</li>
                            <li>player three</li>
                            <li>player four</li>
                        </ul>
                    </div>
                </div>

                <div>
                    <h2>current data:</h2>
                    <div>
                        <ul id="currentData">
                            <li>player one</li>
                            <li>player two</li>
                            <li>player three</li>
                            <li>player four</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>




</body>

<script>
    var svModule = document.querySelectorAll('[sv-module]');
    var svClick = document.querySelectorAll('[sv-click]');

    var activePlayersList = document.querySelector('#activePlayersList');
    var currentData = document.querySelector('#currentData');

    var statusSocket = document.querySelector('#statusSocket');

    const url = 'ws://localhost:8081/'
    const connection = new WebSocket(url)

    var ranking;
    var activePlayers;
    var dataModel = {};
    var clickHandlers = {}

    connection.onopen = () => {
        console.log('open');
        statusSocket.innerHTML = 'open';
    }

    connection.onerror = error => {
        statusSocket.innerHTML = 'error';
        console.log(`WebSocket error: ${error}`)
    }

    connection.onmessage = e => {
        let data = JSON.parse(e.data);
        console.log(data);
        ranking = data.ranking;
        activePlayers = data.activePlayers;

        currentData.innerHTML = '';
        activePlayersList.innerHTML = '';
        playerSelect.innerHTML = '';

        ranking.forEach(element => {
            currentData.innerHTML = currentData.innerHTML +
                `<li>nickname: ${element.nickName} score: ${element.score} email: ${element.email}</li>`
            playerSelect.innerHTML = playerSelect.innerHTML +
                `<option value="${element.nickName}">${element.nickName}</option>`;
        });

        activePlayers.forEach(element => {
            activePlayersList.innerHTML = activePlayersList.innerHTML +
                `<li>nickname: ${element.player.nickName} score: ${element.player.score} email: ${element.player.email}</li>`
        });
    }


    clickHandlers.startGame = function (e) {
        connection.send('{"eventName": "startGame"}');
    }
    clickHandlers.resetGame = function (e) {
        connection.send('{"eventName": "resetGame"}');
    }
    clickHandlers.updateScore = function (e) {
        connection.send(
            `{"eventName": "updatePlayerScore", "player": {"nickName": "${dataModel.selectNickname}", "score":${dataModel.score} }}`
            );
    }
    clickHandlers.addPokeMaster = function (e) {
        connection.send(
            '{"eventName": "addNewPlayer", "player": {"nickName": "pokeMaster","fullName": "ash ketchum", "email": "ash.ketchum@gmail.com"}}'
            );
    }
    clickHandlers.addMashdamman = function (e) {
        connection.send(
            '{"eventName": "addNewPlayer", "player": {"nickName": "mashdamman","fullName": "molly malone", "email": "molly.malone@gmail.com"}}'
            );
    }
    clickHandlers.addBugganator = function (e) {
        connection.send(
            '{"eventName": "addNewPlayer", "player": {"nickName": "bugganator","fullName": "natalia zwamata", "email": "natalia.zwamata@gmail.com"}}'
            );
    }

    clickHandlers.addSamuraiJack = function (e) {
        connection.send(
            '{"eventName": "addNewPlayer", "player": {"nickName": "samurai jack","fullName": "hosi san", "email": "hosi.san@gmail.com"}}'
            );
    }

    clickHandlers.submitNewPlayer = function (e) {
        connection.send(
            `{"eventName": "addNewPlayer", "player": {"nickName": "${dataModel.nickName}","fullName": "${dataModel.fullName}", "email": "${dataModel.email}"}}`
            );
    }

    var inputHandler = function (e) {
        dataModel[e.target.getAttribute('sv-module')] = e.target.value;
    }
    var clickHandler = function (e) {
        e.preventDefault();
        clickHandlers[e.target.getAttribute('sv-click')]();
    }
    svModule.forEach(function (element) {
        element.oninput = inputHandler
    })
    svClick.forEach(function (element) {
        element.addEventListener("click", clickHandlers[element.getAttribute('sv-click')])
    })
</script>

</html>